STEP 1

Typing `./configure` modifies the files `Makefile` and `zconf.h`, and generates a couple of other files that weren't present. tis-interpreter, as a compilation platform, is identical neither  to the host platform on which I typed `./configure` nor to the minimal compilation platform that the initial zconf.h targeted without assumptions. But tis-interpreter is closer to the latter, and also I may want to compile zlib with an ordinary compiler later, so I will go with the flow and start from the `zconf.h` that was generated when I typed `./configure`. We will not use the generated `Makefile` for tis-interpreter, instead passing the C source files on the command-line.

%%%

STEP 2

We will want to invoke the program minigzip, provided in the [tests] directory, in decompression mode, as if this utility had been invoked as `program -d input.gz`. Note that minigzip [tests the name it has been invoked under](https://github.com/pascal-cuoq/zlib-fork/blob/6efef49d0ffd78f82e1ae7127cc3819d64ebc219/test/minigzip.c#L579). By default, tis-interpreter invokes it as “program”, but we use the command-line options to specify decompression:

```
gzip < compress.c > compress.c.gz
tis-mkfs -local input.gz:compress.c.gz -nb-max-files 5
tis-interpreter.sh test/minigzip.c *.c --fs -val-args=" -d input.gz"
```

The `*.c` in the list of files passed to tis-interpreter includes the `mkfs_filesystem.c` file that was generated by `tis-mkfs`.

The result we get is:
```
[kernel] user error: Incompatible declaration for deflate:
                     Definitions of type z_streamp are not isomorphic. Reason follows:
                     Definitions of type z_stream are not isomorphic. Reason follows:
                     Definitions of struct z_stream_s are not isomorphic. Reason follows:
                     different number of fields in struct internal_state and struct internal_state: 1 != 59.
                     First declaration was at  zlib.h:246
                     Current declaration is at zlib.h:246
[kernel] Frama-C aborted: invalid user input.
```

Good, but not great.

%%%




